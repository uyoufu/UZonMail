import{_ as i}from"./plugin-vue_export-helper-DlAUqK2U.js";import{c as e,a,o as n}from"./app-ByxOTFMR.js";const t={};function l(d,s){return n(),e("div",null,s[0]||(s[0]=[a(`<p>On low-end VPS (1 CPU, 1GB RAM, 20GB disk) heavy mail stacks like Mailcow are impractical. This guide focuses on a lightweight Postfix-based setup that can reliably send mail.</p><p>This tutorial uses the domain <code>uzoncloud.com</code> as an example. Adjust domain names and IPs to match your environment.</p><h2 id="options-comparison" tabindex="-1"><a class="header-anchor" href="#options-comparison"><span>Options comparison</span></a></h2><p>Popular solutions include:</p><ol><li>Mailcow</li><li>iRedMail</li><li>Postfix (manual)</li></ol><p>Mailcow is a popular full-featured open-source mail stack built on Postfix. The first two solutions are heavier and require more resources. For low-spec machines Postfix is recommended.</p><h2 id="recommended-components" tabindex="-1"><a class="header-anchor" href="#recommended-components"><span>Recommended components</span></a></h2><p>To minimize resource usage, a low-level implementation is most efficient. Recommended stack:</p><table><thead><tr><th>#</th><th>Software</th><th>Purpose</th></tr></thead><tbody><tr><td>1</td><td>Postfix</td><td>SMTP server for sending/receiving mail</td></tr><tr><td>2</td><td>Dovecot</td><td>IMAP/POP3 server for mailbox storage and client access</td></tr></tbody></table><h2 id="overview-of-steps" tabindex="-1"><a class="header-anchor" href="#overview-of-steps"><span>Overview of steps</span></a></h2><ol><li>Configure DNS: hostnames, MX, SPF, DMARC, DKIM, smtp/pop/imap host records.</li><li>Install and configure Postfix with TLS/STARTTLS.</li><li>Install and configure Dovecot for IMAP/POP and SMTP authentication.</li><li>Install OpenDKIM and generate DKIM keys.</li><li>Configure PTR/RDNS at your VPS provider.</li></ol><h3 id="dns-configuration" tabindex="-1"><a class="header-anchor" href="#dns-configuration"><span>DNS configuration</span></a></h3><p>Example DNS records:</p><table><thead><tr><th>Type</th><th>Name</th><th>FQDN</th><th>Value</th><th>Purpose</th><th>Required</th></tr></thead><tbody><tr><td>A</td><td>mail1</td><td><a href="http://mail1.uzonmail.com" target="_blank" rel="noopener noreferrer">mail1.uzonmail.com</a></td><td>your server IP</td><td>host name and RDNS</td><td>Yes</td></tr><tr><td>MX</td><td>@</td><td><a href="http://uzoncloud.com" target="_blank" rel="noopener noreferrer">uzoncloud.com</a></td><td><a href="http://mx.uzoncloud.com" target="_blank" rel="noopener noreferrer">mx.uzoncloud.com</a></td><td>mail exchange record</td><td>Yes</td></tr><tr><td>TXT</td><td>@</td><td><a href="http://uzoncloud.com" target="_blank" rel="noopener noreferrer">uzoncloud.com</a></td><td>v=spf1 a mx ip4:xx.xx.xx.xx ~all</td><td>SPF record to authorize sending IPs</td><td>Yes</td></tr><tr><td>TXT</td><td>mail1</td><td><a href="http://mail1.uzonmail.com" target="_blank" rel="noopener noreferrer">mail1.uzonmail.com</a></td><td>v=spf1 <a href="http://redirect=uzoncloud.com" target="_blank" rel="noopener noreferrer">redirect=uzoncloud.com</a></td><td>SPF redirect for host</td><td>Yes</td></tr><tr><td>TXT</td><td>_dmarc</td><td>_dmarc.uzoncloud.com</td><td>v=DMARC1; p=quarantine; pct=100; adkim=r; aspf=r</td><td>DMARC policy and reporting</td><td>Yes</td></tr><tr><td>TXT</td><td>default._domainkey</td><td>default._domainkey.uzoncloud.com</td><td>v=DKIM1; k=rsa; p=PUBLICKEY</td><td>DKIM public key</td><td>Yes</td></tr></tbody></table><p>Optional records (smtp/pop/imap hosts and alternate MX) can be added as needed.</p><p>Notes:</p><ol><li>If <code>mx</code> is not set, ensure SPF references the correct host.</li><li>DKIM key pair is generated during the OpenDKIM setup step.</li><li>Adding <code>mail1</code> SPF reduces &quot;SPF: HELO does not publish an SPF Record&quot; warnings.</li></ol><h3 id="install-postfix" tabindex="-1"><a class="header-anchor" href="#install-postfix"><span>Install Postfix</span></a></h3><p>Install Postfix and choose &quot;Internet Site&quot; during setup:</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">sudo</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> apt</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> update</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">sudo</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> apt</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> install</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -y</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> postfix</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p>Configure <code>main.cf</code> with minimum settings. Example commands:</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># set hostname</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">sudo</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> postconf</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -e</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;myhostname = mail1.uzoncloud.com&quot;</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># store mail in Maildir</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">sudo</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> postconf</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -e</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &#39;home_mailbox = Maildir/&#39;</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># accepted destinations</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">sudo</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> postconf</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -e</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &#39;mydestination = $myhostname, localhost.$mydomain, localhost, uzoncloud.com, mx.uzoncloud.com&#39;</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># log file</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">sudo</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> postconf</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -e</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &#39;maillog_file=/var/log/postfix.log&#39;</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># mailbox size (0 = unlimited)</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">sudo</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> postconf</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -e</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &#39;mailbox_size_limit = 0&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># Enable SASL via Dovecot for SMTP AUTH</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">sudo</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> postconf</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -e</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &#39;smtpd_sasl_type = dovecot&#39;</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">sudo</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> postconf</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -e</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &#39;smtpd_sasl_path = private/auth&#39;</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">sudo</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> postconf</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -e</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &#39;smtpd_sasl_local_domain = $myhostname&#39;</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">sudo</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> postconf</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -e</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &#39;smtpd_sasl_security_options = noanonymous,noplaintext&#39;</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">sudo</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> postconf</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -e</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &#39;smtpd_sasl_tls_security_options = noanonymous&#39;</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">sudo</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> postconf</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -e</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &#39;broken_sasl_auth_clients = yes&#39;</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">sudo</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> postconf</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -e</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &#39;smtpd_sasl_auth_enable = yes&#39;</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">sudo</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> postconf</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -e</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &#39;smtpd_recipient_restrictions = permit_sasl_authenticated,permit_mynetworks,reject_unauth_destination&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># TLS settings (use certificates from ACME or your provider)</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">sudo</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> postconf</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -e</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &#39;smtp_tls_security_level = may&#39;</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">sudo</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> postconf</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -e</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &#39;smtpd_tls_security_level = may&#39;</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">sudo</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> postconf</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -e</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &#39;smtpd_tls_key_file = /etc/nginx/conf.d/cert/uzoncloud.com.key&#39;</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">sudo</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> postconf</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -e</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &#39;smtpd_tls_cert_file = /etc/nginx/conf.d/cert/uzoncloud.com.cert&#39;</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">sudo</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> postconf</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -e</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &#39;smtpd_tls_loglevel = 1&#39;</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">sudo</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> postconf</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -e</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &#39;smtpd_tls_received_header = yes&#39;</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">sudo</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> postconf</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -e</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &#39;smtpd_tls_auth_only = yes&#39;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="configure-smtps-submission" tabindex="-1"><a class="header-anchor" href="#configure-smtps-submission"><span>Configure SMTPS/Submission</span></a></h4><p>Harden MUA (Mail User Agent) restrictions for submission ports (587/465). Edit <code>/etc/postfix/master.cf</code> and ensure <code>submission</code>/<code>submissions</code> entries provide STARTTLS/TLS and required security options. Add restrictions so only authenticated clients can submit mail.</p><p>Example additions include enforcing <code>smtpd_sasl_auth_enable=yes</code> and applying client/helo/sender/relay/recipient restrictions for MUAs.</p><h4 id="redirect-system-account-mail-optional" tabindex="-1"><a class="header-anchor" href="#redirect-system-account-mail-optional"><span>Redirect system account mail (optional)</span></a></h4><p>Edit <code>/etc/aliases</code> to redirect system mail for <code>root</code>/<code>postmaster</code> to your admin user to avoid mail being written to local system mailboxes.</p><h3 id="install-dovecot" tabindex="-1"><a class="header-anchor" href="#install-dovecot"><span>Install Dovecot</span></a></h3><p>Install Dovecot for IMAP/POP3 and configure authentication for Postfix:</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">sudo</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> apt</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> install</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -y</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> dovecot-core</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> dovecot-imapd</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> dovecot-pop3d</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>Dovecot config files are in <code>/etc/dovecot/conf.d</code>.</p><p>Edit <code>10-auth.conf</code> to allow login mechanism <code>plain login</code>.</p><p>Edit <code>10-master.conf</code> to add the Postfix auth socket listener:</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>unix_listener /var/spool/postfix/private/auth {</span></span>
<span class="line"><span>  mode = 0660</span></span>
<span class="line"><span>  user = postfix</span></span>
<span class="line"><span>  group = postfix</span></span>
<span class="line"><span>}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Set mailbox location in <code>/etc/dovecot/dovecot.conf</code>:</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>mail_location = maildir:~/Maildir</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>Configure SSL in <code>10-ssl.conf</code> to point to your certificate files.</p><h3 id="install-opendkim" tabindex="-1"><a class="header-anchor" href="#install-opendkim"><span>Install OpenDKIM</span></a></h3><p>OpenDKIM signs outgoing mail and verifies incoming signatures. Steps:</p><ol><li>Install:</li></ol><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">sudo</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> apt</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> update</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">sudo</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> apt</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> install</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -y</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> opendkim</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> opendkim-tools</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><ol start="2"><li>Generate DKIM keys:</li></ol><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">sudo</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> mkdir</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -p</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> /etc/opendkim/keys/uzoncloud.com</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">sudo</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> opendkim-genkey</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -s</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> default</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -d</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> uzoncloud.com</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -D</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> /etc/opendkim/keys/uzoncloud.com</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">sudo</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> chown</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> opendkim:opendkim</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> /etc/opendkim/keys/uzoncloud.com/default.private</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">sudo</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> chmod</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 600</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> /etc/opendkim/keys/uzoncloud.com/default.private</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># view public key for DNS TXT record</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">cat</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> /etc/opendkim/keys/uzoncloud.com/default.txt</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol start="3"><li><p>Add the public key value to DNS as <code>default._domainkey.uzoncloud.com</code> (paste and remove surrounding quotes/newlines as instructed).</p></li><li><p>Configure <code>/etc/opendkim.conf</code> with <code>Domain</code>, <code>KeyFile</code>, <code>Selector</code>, and socket settings (e.g., <code>Socket inet:8891@localhost</code>).</p></li><li><p>Create KeyTable, SigningTable and TrustedHosts files:</p></li></ol><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">echo</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;default._domainkey.uzoncloud.com uzoncloud.com:default:/etc/opendkim/keys/uzoncloud.com/default.private&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> &gt; </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">/etc/opendkim/KeyTable</span></span>
<span class="line"><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">echo</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;*@uzoncloud.com default._domainkey.uzoncloud.com&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> &gt; </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">/etc/opendkim/SigningTable</span></span>
<span class="line"><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">echo</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -e</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;localhost</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">127.0.0.1</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">::1</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">uzoncloud.com&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> &gt; </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">/etc/opendkim/TrustedHosts</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol start="6"><li>Validate config:</li></ol><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">sudo</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> opendkim</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -n</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -c</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> /etc/opendkim.conf</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><ol start="7"><li>Integrate with Postfix: add milter settings to <code>/etc/postfix/main.cf</code>:</li></ol><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">milter_default_action</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> =</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> accept</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">smtpd_milters</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> =</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> inet:localhost:8891</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">non_smtpd_milters</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> =</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> $smtpd_milters</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Optionally add per-service milter lines in <code>/etc/postfix/master.cf</code> for smtp/submission.</p><h3 id="user-management" tabindex="-1"><a class="header-anchor" href="#user-management"><span>User management</span></a></h3><p>Start services and create mail users. Example:</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">sudo</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> systemctl</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> start</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> postfix</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> dovecot</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> opendkim</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">sudo</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> systemctl</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> enable</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> postfix</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> dovecot</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> opendkim</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p>Add mail users according to your chosen userdb (system users, virtual users, or other backends). Configure Dovecot accordingly.</p>`,54)]))}const p=i(t,[["render",l],["__file","postfix.html.vue"]]),r=JSON.parse('{"path":"/en/self-hosted/postfix","title":"Self-Hosted Postfix Mail Server","lang":"en-US","frontmatter":{"title":"Self-Hosted Postfix Mail Server","icon":"server","order":1,"description":"Using `uzoncloud.com` as an example, this guide explains how to build a production-grade Postfix mail server on low-spec VPS (DNS, MX/SPF/DMARC/DKIM, Postfix + Dovecot + OpenDKIM, SMTPS/STARTTLS, user management, PTR/RDNS) suitable for use with UzonMail for bulk sending.","permalink":"/en/self-hosted/postfix","head":[["link",{"rel":"alternate","hreflang":"zh-cn","href":"https://mail.uzoncloud.com/self-hosted/postfix"}],["meta",{"property":"og:url","content":"https://mail.uzoncloud.com/en/self-hosted/postfix"}],["meta",{"property":"og:site_name","content":"UzonMail"}],["meta",{"property":"og:title","content":"Self-Hosted Postfix Mail Server"}],["meta",{"property":"og:description","content":"Using `uzoncloud.com` as an example, this guide explains how to build a production-grade Postfix mail server on low-spec VPS (DNS, MX/SPF/DMARC/DKIM, Postfix + Dovecot + OpenDKIM, SMTPS/STARTTLS, user management, PTR/RDNS) suitable for use with UzonMail for bulk sending."}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:locale","content":"en-US"}],["meta",{"property":"og:locale:alternate","content":"zh-CN"}],["meta",{"property":"og:updated_time","content":"2025-12-25T09:32:32.000Z"}],["meta",{"property":"article:modified_time","content":"2025-12-25T09:32:32.000Z"}],["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"Self-Hosted Postfix Mail Server\\",\\"image\\":[\\"\\"],\\"dateModified\\":\\"2025-12-25T09:32:32.000Z\\",\\"author\\":[{\\"@type\\":\\"Person\\",\\"name\\":\\"uyoufu\\",\\"url\\":\\"https://uyoufu.uzoncloud.com/\\"}]}"]]},"headers":[{"level":2,"title":"Options comparison","slug":"options-comparison","link":"#options-comparison","children":[]},{"level":2,"title":"Recommended components","slug":"recommended-components","link":"#recommended-components","children":[]},{"level":2,"title":"Overview of steps","slug":"overview-of-steps","link":"#overview-of-steps","children":[{"level":3,"title":"DNS configuration","slug":"dns-configuration","link":"#dns-configuration","children":[]},{"level":3,"title":"Install Postfix","slug":"install-postfix","link":"#install-postfix","children":[]},{"level":3,"title":"Install Dovecot","slug":"install-dovecot","link":"#install-dovecot","children":[]},{"level":3,"title":"Install OpenDKIM","slug":"install-opendkim","link":"#install-opendkim","children":[]},{"level":3,"title":"User management","slug":"user-management","link":"#user-management","children":[]}]}],"git":{"createdTime":1766655152000,"updatedTime":1766655152000,"contributors":[{"name":"galens","username":"galens","email":"gmx_galens@163.com","commits":1,"url":"https://github.com/galens"}]},"readingTime":{"minutes":2.92,"words":875},"filePathRelative":"en/self-hosted/postfix.md","localizedDate":"December 25, 2025"}');export{p as comp,r as data};
